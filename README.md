**Этапы проекта**  
Этап 0: создание БД (или коррекция полей данной в проекте БД)
- stage0_staging_create.sql
- stage0_mart_create.sql
- коррекция и запуск начального dag для заполнения таблиц БД - имитируем ежедневный рабочий процесс перед появлением нового поля статуса и инкрементов

*Мой проект основан на представлении о том, что каждый день необходимо загружать "основной отчет" (цит. по описанию проекта и вебинару), а инкременты добавлять на текущий день, который не вошел в основной отчет.  
При этом, основной отчет ежедневно перезатирается в staging, так как ежедневная выгрузка содержит данные за одинаковые даты (так было на момент проектирования дага. Если ежедневный отчет не нужно затирать, то убираем таски truncate и я бы добавила поле с датой загрузки).
К сожалению, осталось не ясным, почему новые загрузки основного отчета не включают статус заказа.*

Этап 1
- добавляем в staging.user_orders_log и mart.f_daily_sales поле status вне dag - так как эта операция не требует повторения;
- в staging заполняем это поле вне dag;
- в dag прописываем добавление этого поля в файлы csv, если оно отсутствует, как в основной выгрузке s3, так и инкрементах,
- в dag при обновлении mart.f_daily_sales прописываем отрицательные значения price и payment_amount, если статус refunded. 
- добавила проверку наличия данных в основных таблицах в staging (user_orders_log, user_activity_log)


Этап 2  
stage2_create_view.sql

Этап 3  
Я считаю, что в существующем даге обеспечивается идемпотентность данных, потому что данные в staging каждый раз перезатираются, а в mart обновляются все данные за даты, присутствующие в staging. Минус данного дага в том, что он перезатирает данные в staging, но тут, имхо, надо подробнее описать задание, приходящие данные и сделать загружаемые файлы более реалистичными.

*Не получилось вызывать большие запросы sql из отдельных файлов - не смогла указать корректный путь.*