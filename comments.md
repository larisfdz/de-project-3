–°–∞—à–∞, –ø—Ä–∏–≤–µ—Ç.
–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≤—å—é, –≤–∏–¥–Ω–æ, —á—Ç–æ —Ç—ã —Ä–µ–∞–ª—å–Ω–æ —á–∏—Ç–∞–ª –≤–µ—Å—å –∫–æ–¥)
–ó–¥–µ—Å—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏–ª–∏ –ø–æ —Ç–æ–º—É, —á—Ç–æ —è –Ω–µ —Å–¥–µ–ª–∞–ª–∞. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è —è —É—Å—Ç—Ä–∞–Ω–∏–ª–∞ (–ø–æ–ª–∞–≥–∞—é).
NB: —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã sql —è –ø–æ–ª–æ–∂–∏–ª–∞ –∫ dag –≤ –ø–∞–ø–∫—É sql, –ø–∞–ø–∫–∞ migrations —Ç–µ–ø–µ—Ä—å –ø—É—Å—Ç–∞—è.

**–≠—Ç–∞–ø 0**
–Ø –∑–∞–≤–µ—Ä–Ω—É–ª–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ staging –∏ mart –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–∞–≥ etl_tables_migration, —Ö–æ—Ç—è –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —ç—Ç–æ –∏–∑–ª–∏—à–Ω–µ. –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã, –≤–µ–¥—å —ç—Ç–æ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –ø—Ä–æ—Ü–µ—Å—Å.  

**–≠—Ç–∞–ø 1**  
[min_threshold=5, max_threshold=1000000] - –º–∏–Ω–∏–º—É–º –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–ø—Ä–∏–Ω—Ç–µ, –º–∞–∫—Å–∏–º—É–º –Ω–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–∞ —Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –±–µ–∑ –Ω–µ–≥–æ –Ω–µ–ª—å–∑—è, –≤—ã–±—Ä–∞–ª–∞ –ø—Ä–æ—Å—Ç–æ –±–æ–ª—å—à–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–í–æ—Ç —ç—Ç–æ –≤–æ—Ç –æ–∫–∞–∑–∞–ª–æ—Å—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ:
*"–∫–∞–∫–∞—è-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –≤–Ω—É—Ç—Ä–∏ ü§î –∞ –ø–æ—á–µ–º—É –Ω–µ –ø—Ä–æ—Å—Ç–æ PostgresOperator?"*
–¢–∞—Å–∫ —Å PostgresOperator —É –º–µ–Ω—è –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–ª –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ —Å–∞–º–æ–≥–æ –¥–∞–≥–∞ (—è –Ω–µ –≤–∫–ª—é—á–∞–ª–∞ –µ–≥–æ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞—Å–∫–æ–≤). –ê –ø–æ—Å–ª–µ rows_check_task (—Ç–æ –µ—Å—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –∫–æ–≥–¥–∞ –æ–Ω –¥–æ–ª–∂–µ–Ω –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏) –≤—ã–¥–∞–≤–∞–ª –æ—à–∏–±–∫—É:
" Marking task as SUCCESS. dag_id=etl_update_user_data_project, task_id=rows_check_task.check_rows_order_log, execution_date=20220626T132532, start_date=20220626T132738, end_date=20220626T132739
[2022-06-26, 13:27:39 UTC] {local_task_job.py:156} INFO - Task exited with return code 0
[2022-06-26, 13:27:39 UTC] {taskinstance.py:1740} ERROR - Error when executing on_success_callback
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/airflow/models/taskinstance.py", line 1738, in _run_finished_callback
    task.on_success_callback(context)
TypeError: 'PostgresOperator' object is not callable "

–ù–æ –≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é —Ç–æ–∂–µ –æ–∫–∞–∑–∞–ª—Å—è –Ω–µ—Ä–∞–±–æ—á–∏–º. –Ø –Ω–∞—à–ª–∞ –ø–æ—Ö–æ–∂—É—é –ø—Ä–æ–±–ª–µ–º—É https://stackoverflow.com/questions/67229594/airflow-running-postgresoperator-within-a-pythonoperator-with-taskflow-api, –≥–¥–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ PostgresOperator –Ω–µ –≤–∏–¥–∏—Ç –ø—É—Å—Ç—å –¥–æ query.sql. –ù–æ —è –Ω–µ —Å–º–æ–≥–ª–∞ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–∞–∂–µ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—è –∫–æ–º–∞–Ω–¥—É. –ù–∞—à–ª–∞ —Ä–∞–±–æ—á–µ–µ —Ä–µ—à–µ–Ω–∏–µ. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, –º–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, —á—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ç—ã—Ä–µ —Ä–∞–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–æ –¥–≤–µ –Ω–∞ –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É, –Ω–∞ —Å–ª—É—á–∞–π failure / success), –Ω–æ —É –º–µ–Ω—è –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç failure / success.


**–≠—Ç–∞–ø 2**  
–Ø –∑–∞–º–µ–Ω–∏–ª–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É, –Ω–æ –Ω–µ –º–µ–Ω—è–ª–∞ period_id (—É –º–µ–Ω—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –≥–æ–¥–∞ –∏ –º–µ—Å—è—Ü–∞ –≤–º–µ—Å—Ç–µ). –Ø –ø–æ–Ω—è–ª–∞, —á—Ç–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ –∑–∞–º–µ—á–µ–Ω–∏–µ, –∏ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è —É–¥–æ–±–Ω—ã–º, —á—Ç–æ –≥–æ–¥ –∏ –º–µ—Å—è—Ü –ø–µ—Ä–∏–æ–¥–∞ —É–∫–∞–∑–∞–Ω—ã –≤ –æ–¥–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ.

